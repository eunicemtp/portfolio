---
// Astro frontmatter
import projets from '../../data/projets.json';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
    return projets.map((projet) => ({
      params: { slug: projet.slug }
    }));
  }

const { slug } = Astro.params;
const projet = projets.find((p) => p.slug === slug);

if (!projet) throw new Error(`Projet not found: ${slug}`);

const currentIndex = projets.findIndex((p) => p.slug === slug);
const previous = projets[currentIndex - 1] || null;
const next = projets[currentIndex + 1] || null;
---

<Layout title={projet.nom} pageClass="work-detail">
  <!-- HERO -->
  <section class="bg-purple-light text-blue py-20 px-6 md:px-16">
    <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-h1 font-bold mb-4">{projet.nom}</h1>
        {projet.slogan && <p class="text-lg leading-relaxed">{projet.slogan}</p>}
      </div>
      {projet.image && <img src={projet.image} alt={projet.nom} class="rounded-xl shadow-lg max-w-full" />}
    </div>
  </section>

  <!-- ABOUT SECTION -->
  {projet.about && (
    <section class="bg-whitey text-blue py-16 px-6 md:px-16">
      <div class="max-w-4xl mx-auto space-y-6">
        <h2 class="text-h3 font-bold">About the project</h2>
        <p>{projet.about}</p>
      </div>
    </section>
  )}

  <!-- GALLERY -->
  {projet.gallery && projet.gallery.length > 0 && (
    <section class="bg-mint py-16 px-6 md:px-16">
      <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-8">
        {projet.gallery.map(img => (
          <img src={img} alt="Visual for {projet.nom}" class="rounded-xl shadow-md hover:scale-105 transition" />
        ))}
      </div>
    </section>
  )}

  <!-- TECH STACK -->
  {projet.stack && projet.stack.length > 0 && (
    <section class="bg-white py-16 px-6 md:px-16 text-blue">
      <div class="max-w-4xl mx-auto space-y-8">
        <h2 class="text-h4 font-bold">Tech stack</h2>
        <div class="flex flex-wrap gap-4">
          {projet.stack.map(tech => (
            <span class="bg-purple-light text-purple-darker px-4 py-2 rounded-full text-sm font-semibold shadow-sm">
              {tech}
            </span>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- NAVIGATION -->
  <section class="bg-purple-light py-10 text-center flex flex-col md:flex-row justify-between px-6 md:px-16">
    {previous && (
      <a href={`/work/${previous.slug}`} class="text-white underline font-bold hover:text-blue transition">← {previous.nom}</a>
    )}
    <a href="/work" class="text-white underline font-bold hover:text-blue transition my-4 md:my-0">Back to all projects</a>
    {next && (
      <a href={`/work/${next.slug}`} class="text-white underline font-bold hover:text-blue transition">{next.nom} →</a>
    )}
  </section>
</Layout>


